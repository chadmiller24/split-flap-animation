<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Split-Flap Animation</title>
  <style>
    @font-face {
      font-family: 'IBM Plex Mono';
      src: url('IBMPlexMono-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000000;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'IBM Plex Mono', monospace;
    }

    .board {
      background: #000000;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .row {
      display: flex;
      gap: 4px;
    }

    .cell {
      width: 80px;
      height: 100px;
      position: relative;
      perspective: 300px;
    }

    /* Top and bottom static halves */
    .top-half, .bottom-half {
      position: absolute;
      width: 100%;
      height: 50%;
      overflow: hidden;
      display: flex;
      justify-content: center;
      background: url('tile.png') center/80px 100px no-repeat;
    }

    .top-half {
      top: 0;
      border-radius: 8px 8px 0 0;
      align-items: flex-end;
      background-position: top center;
    }

    .bottom-half {
      bottom: 0;
      border-radius: 0 0 8px 8px;
      align-items: flex-start;
      background-position: bottom center;
    }

    .top-half .char-display {
      transform: translateY(50%);
    }

    .bottom-half .char-display {
      transform: translateY(-50%);
    }

    .char-display {
      font-size: 72px;
      font-weight: 400;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      line-height: 1;
    }

    /* The flipping flap */
    .flap {
      position: absolute;
      width: 100%;
      height: 50%;
      top: 0;
      transform-style: preserve-3d;
      transform-origin: bottom center;
      z-index: 10;
    }

    .flap-front, .flap-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      overflow: hidden;
      display: flex;
      justify-content: center;
      background: url('tile.png') center/80px 100px no-repeat;
    }

    .flap-front {
      background-position: top center;
      border-radius: 8px 8px 0 0;
      align-items: flex-end;
    }

    .flap-front .char-display {
      transform: translateY(50%);
    }

    .flap-back {
      background-position: bottom center;
      border-radius: 0 0 8px 8px;
      transform: rotateX(180deg);
      align-items: flex-start;
    }

    .flap-back .char-display {
      transform: translateY(-50%);
    }

    .flap.flipping {
      animation: flipDown 0.08s ease-in forwards;
    }

    @keyframes flipDown {
      0% {
        transform: rotateX(0deg);
      }
      100% {
        transform: rotateX(-180deg);
      }
    }

    /* Horizontal split line */
    .split-line {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: #000;
      z-index: 20;
      transform: translateY(-50%);
    }

    /* Chevron styling */
    .chevron {
      font-size: 60px;
    }

    /* Shopify logo */
    .logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .logo-container svg {
      width: 50px;
      height: 50px;
    }

    /* Click to replay */
    .replay-hint {
      position: fixed;
      bottom: 20px;
      color: #666;
      font-size: 14px;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <div class="board" id="board"></div>
  <div class="replay-hint">Click anywhere to replay</div>

  <script>
    const shopifyLogo = `<svg width="61" height="61" viewBox="0 0 61 61" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M40.5809 7.11622C40.576 7.11622 39.9 7.32688 38.7535 7.68207C38.5625 7.06233 38.2808 6.3005 37.879 5.53378C36.5857 3.06459 34.6897 1.7565 32.3993 1.75405C32.3968 1.75405 32.3944 1.75405 32.3919 1.75405C32.2327 1.75405 32.0759 1.76875 31.9167 1.78344C31.8506 1.70261 31.782 1.62177 31.7085 1.54584C30.7115 0.477811 29.4304 -0.0415038 27.8969 0.00258893C24.9378 0.0883248 21.9934 2.22437 19.6051 6.0188C17.9246 8.68886 16.6459 12.0448 16.2834 14.6389C12.8858 15.6898 10.5097 16.4271 10.4583 16.4418C8.74354 16.9807 8.68965 17.0346 8.46428 18.6489C8.29771 19.8737 3.8125 54.5625 3.8125 54.5625L41.0317 61V7.04028C40.848 7.05253 40.6838 7.08682 40.5809 7.11622ZM31.9878 9.77648C30.0183 10.3864 27.8675 11.0527 25.7119 11.719C26.3194 9.39679 27.4683 7.08192 28.8817 5.56807C29.4083 5.00467 30.1432 4.37512 31.0128 4.01748C31.8285 5.72485 32.0074 8.1426 31.9878 9.77648ZM27.9582 1.97206C28.6539 1.95737 29.2369 2.10924 29.7366 2.43994C28.938 2.85392 28.1639 3.45162 27.4389 4.22814C25.56 6.24416 24.1197 9.37475 23.5465 12.3927C21.7558 12.9463 20.0019 13.4901 18.39 13.9898C19.4091 9.23512 23.3921 2.10189 27.9582 1.97206ZM22.2016 29.0426C22.4025 32.2099 30.7311 32.9007 31.199 40.3181C31.5664 46.153 28.1051 50.1434 23.1129 50.4594C17.1236 50.8366 13.8265 47.3043 13.8265 47.3043L15.0953 41.9054C15.0953 41.9054 18.4145 44.4089 21.0699 44.2423C22.8042 44.1321 23.424 42.7211 23.3627 41.7241C23.1031 37.5941 16.3201 37.8366 15.8915 31.0512C15.5314 25.3388 19.2817 19.5528 27.5564 19.0311C30.7458 18.8302 32.3772 19.6435 32.3772 19.6435L30.4837 26.7228C30.4837 26.7228 28.3722 25.7625 25.8711 25.9193C22.2041 26.1471 22.1649 28.462 22.2016 29.0426ZM33.9548 9.16898C33.9327 7.66983 33.7539 5.58767 33.0558 3.78477C35.2996 4.211 36.4068 6.74878 36.8723 8.26508C36.0076 8.53209 35.0204 8.83828 33.9548 9.16898Z" fill="white"/>
<path d="M42.2615 60.8531L57.7013 57.0146C57.7013 57.0146 51.0531 12.0669 51.0114 11.7583C50.9698 11.4496 50.7003 11.2806 50.4774 11.261C50.2545 11.2414 45.9089 11.1753 45.9089 11.1753C45.9089 11.1753 43.2585 8.60076 42.2639 7.62827V60.8531H42.2615Z" fill="white"/>
</svg>`;

    const FLAP_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&*+-=.:;<>?';

    const rows = [
      { text: '              ', delay: 0 },
      { text: '              ', delay: 0 },
      { text: 'EVERYWHERE    ', delay: 0 },
      { text: '    EDITION  S', delay: 800, hasLogo: true },
      { text: '>>>           ', delay: 1600, isChevron: true },
      { text: 'SECTION       ', delay: 2400 },
      { text: '              ', delay: 0 },
      { text: '              ', delay: 0 }
    ];

    const CELLS_PER_ROW = 14;
    const CHAR_DELAY = 60;
    const FLIP_DURATION = 80;
    const MIN_FLIPS = 6;
    const MAX_FLIPS = 14;

    function getRandomChar() {
      return FLAP_CHARS[Math.floor(Math.random() * FLAP_CHARS.length)];
    }

    function createCharDisplay(char, isLogo, isChevron) {
      if (isLogo) {
        const container = document.createElement('div');
        container.className = 'char-display logo-container';
        container.innerHTML = shopifyLogo;
        return container;
      }
      const span = document.createElement('span');
      span.className = 'char-display' + (isChevron ? ' chevron' : '');
      span.textContent = char;
      return span;
    }

    function createCell(targetChar, isLogo, isChevron) {
      const cell = document.createElement('div');
      cell.className = 'cell';

      // Bottom half (static, shows current char)
      const bottomHalf = document.createElement('div');
      bottomHalf.className = 'bottom-half';
      bottomHalf.appendChild(createCharDisplay('', isLogo, isChevron));

      // Top half (static, shows current char)
      const topHalf = document.createElement('div');
      topHalf.className = 'top-half';
      topHalf.appendChild(createCharDisplay('', isLogo, isChevron));

      // Flap (the animated part)
      const flap = document.createElement('div');
      flap.className = 'flap';

      const flapFront = document.createElement('div');
      flapFront.className = 'flap-front';
      flapFront.appendChild(createCharDisplay('', isLogo, isChevron));

      const flapBack = document.createElement('div');
      flapBack.className = 'flap-back';
      flapBack.appendChild(createCharDisplay('', isLogo, isChevron));

      flap.appendChild(flapFront);
      flap.appendChild(flapBack);

      // Split line
      const splitLine = document.createElement('div');
      splitLine.className = 'split-line';

      cell.appendChild(bottomHalf);
      cell.appendChild(topHalf);
      cell.appendChild(flap);
      cell.appendChild(splitLine);

      cell.dataset.target = targetChar;
      cell.dataset.isLogo = isLogo ? 'true' : 'false';
      cell.dataset.isChevron = isChevron ? 'true' : 'false';

      return cell;
    }

    function updateCellDisplay(cell, char) {
      const isLogo = cell.dataset.isLogo === 'true';
      const isChevron = cell.dataset.isChevron === 'true';

      const topHalf = cell.querySelector('.top-half .char-display');
      const bottomHalf = cell.querySelector('.bottom-half .char-display');

      if (isLogo && char === 'LOGO') {
        topHalf.innerHTML = shopifyLogo;
        bottomHalf.innerHTML = shopifyLogo;
      } else {
        topHalf.textContent = char;
        bottomHalf.textContent = char;
      }
    }

    function flipCell(cell, fromChar, toChar, callback) {
      const isLogo = cell.dataset.isLogo === 'true';
      const isChevron = cell.dataset.isChevron === 'true';
      const flap = cell.querySelector('.flap');
      const flapFront = flap.querySelector('.flap-front .char-display');
      const flapBack = flap.querySelector('.flap-back .char-display');
      const bottomHalf = cell.querySelector('.bottom-half .char-display');

      // Set up the flap
      if (isLogo && toChar === 'LOGO') {
        flapFront.innerHTML = fromChar === 'LOGO' ? shopifyLogo : fromChar;
        flapBack.innerHTML = shopifyLogo;
      } else {
        flapFront.textContent = fromChar;
        flapBack.textContent = toChar;
      }

      // Reset flap position
      flap.style.transform = 'rotateX(0deg)';
      flap.classList.remove('flipping');

      // Force reflow
      void flap.offsetWidth;

      // Start flip animation
      flap.classList.add('flipping');

      setTimeout(() => {
        // Update the static halves to show the new character
        updateCellDisplay(cell, toChar);
        flap.classList.remove('flipping');
        flap.style.transform = 'rotateX(0deg)';

        if (callback) callback();
      }, FLIP_DURATION);
    }

    function animateCell(cell, callback) {
      const targetChar = cell.dataset.target;
      const isLogo = cell.dataset.isLogo === 'true';

      if (targetChar.trim() === '' && !isLogo) {
        if (callback) callback();
        return;
      }

      const numFlips = MIN_FLIPS + Math.floor(Math.random() * (MAX_FLIPS - MIN_FLIPS));
      let currentFlip = 0;
      let currentChar = '';

      function doFlip() {
        if (currentFlip >= numFlips) {
          // Final flip to target
          const finalChar = isLogo ? 'LOGO' : targetChar;
          flipCell(cell, currentChar, finalChar, callback);
          return;
        }

        const nextChar = getRandomChar();
        flipCell(cell, currentChar, nextChar, () => {
          currentChar = nextChar;
          currentFlip++;
          setTimeout(doFlip, 20);
        });
      }

      doFlip();
    }

    function createBoard() {
      const board = document.getElementById('board');
      board.innerHTML = '';

      rows.forEach((rowData, rowIndex) => {
        const row = document.createElement('div');
        row.className = 'row';

        for (let i = 0; i < CELLS_PER_ROW; i++) {
          const charValue = rowData.text[i] || ' ';
          const isLogo = rowData.hasLogo && i === CELLS_PER_ROW - 1;
          const isChevron = rowData.isChevron && charValue === '>';

          const cell = createCell(charValue, isLogo, isChevron);
          cell.dataset.row = rowIndex;
          cell.dataset.col = i;
          cell.dataset.rowDelay = rowData.delay;

          row.appendChild(cell);
        }

        board.appendChild(row);
      });
    }

    function animateBoard() {
      const cells = document.querySelectorAll('.cell');

      cells.forEach((cell) => {
        const rowDelay = parseInt(cell.dataset.rowDelay);
        const col = parseInt(cell.dataset.col);
        const totalDelay = rowDelay + (col * CHAR_DELAY);

        setTimeout(() => {
          animateCell(cell);
        }, totalDelay);
      });
    }

    // Initialize
    createBoard();
    setTimeout(animateBoard, 500);

    // Click to replay
    document.body.addEventListener('click', () => {
      createBoard();
      setTimeout(animateBoard, 100);
    });
  </script>
</body>
</html>
